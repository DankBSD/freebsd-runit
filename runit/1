#!/bin/sh
PATH=/sbin:/bin:/usr/sbin:/usr/bin:/rescue

. /usr/local/etc/runit/functions

msg "Welcome to $(sysctl -n kern.ostype)!"

detect_jail

if [ -z "${JAILED}" ] && [ -n "$(kenv boot_single 2> /dev/null)" ]; then
	if [ "x$(kenv boot_single)" = "xYES" ]; then
		emergency_shell
	fi
fi

# Start core services: one-time system tasks.
for f in /usr/local/etc/runit/core-services/*.sh; do
	[ -r $f ] && . $f
done

if [ -z "${JAILED}" ]; then
	( umask 022 ; /sbin/dmesg > /var/run/dmesg.boot )
fi

msg "Initialization complete, running stage 2..."
