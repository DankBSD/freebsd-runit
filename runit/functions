msg() {
	echo "=>" "$@"
}

msg_error() {
	echo "ERROR:" "$@"
}

msg_warn() {
	echo "WARNING:" "$@"
}

emergency_shell() {
	if [ -n "${JAILED}" ]; then
		exit 1
	fi
	# Try and load the USB keyboard driver in case
	# it's not yet loaded.  This can e.g. be the case when
	# using a modular kernel.
	kldload -n uhci xhci ohci ehci ukbd > /dev/null 2>&1 || true
	echo
	echo "Cannot continue due to errors above, starting emergency shell."
	echo "When ready type exit to continue booting."
	/bin/sh -p
}

check_arch() {
	for arch in "$@"; do
		if [ "$(sysctl -n hw.machine_arch)" = "${arch}" ]; then
			return 0
		fi
	done
	return 1
}

kernel_has_feature() {
	if [ "$(sysctl -qn "kern.features.$1")" = "1" ]; then
		return 0
	fi
	return 1
}

detect_jail() {
	if [ "$(sysctl -n security.jail.jailed)" -eq 1 ]; then
		export JAILED=1
	fi
}
